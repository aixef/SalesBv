<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Abrir_registro</name>
        <label>Abrir registro</label>
        <locationX>1464</locationX>
        <locationY>53</locationY>
        <actionName>c:MX_WF_AbrirRegistro</actionName>
        <actionType>component</actionType>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>IdCampania</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <assignments>
        <name>Agregar_coma_a_bines</name>
        <label>Agregar coma a bines</label>
        <locationX>1144</locationX>
        <locationY>645</locationY>
        <assignmentItems>
            <assignToReference>V_agrupadordebines</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>,</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Asignar_bines</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Asignar_bines</name>
        <label>Asignar bines</label>
        <locationX>1240</locationX>
        <locationY>478</locationY>
        <assignmentItems>
            <assignToReference>V_agrupadordebines</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>V_Binesdelatarjeta</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Bucle_tarjetas</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Asignar_grupo_comercial</name>
        <label>Asignar grupo comercial</label>
        <locationX>288</locationX>
        <locationY>50</locationY>
        <assignmentItems>
            <assignToReference>IdGrupoComercial</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>v_GrupoComercial</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SeleccionComercios</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>agregar_coma</name>
        <label>agregar coma?</label>
        <locationX>1007</locationX>
        <locationY>492</locationY>
        <defaultConnector>
            <targetReference>Agregar_coma_a_bines</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>agregar coma</defaultConnectorLabel>
        <rules>
            <name>primera_tarjeta</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>V_agrupadordebines</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Asignar_bines</targetReference>
            </connector>
            <label>primera tarjeta</label>
        </rules>
    </decisions>
    <description>Flujo para la aplicación Wf, permite asociar los comercios participantes y las tarjetas participantes a la campaña</description>
    <formulas>
        <name>F_Fechadeultimamodificacion</name>
        <dataType>Date</dataType>
        <expression>TODAY()</expression>
    </formulas>
    <interviewLabel>GrupoComercial_Comercio {!$Flow.CurrentDateTime}</interviewLabel>
    <label>GrupoComercial_Comercio</label>
    <loops>
        <name>Bucle_de_Comercio</name>
        <label>Bucle de Comercio</label>
        <locationX>617</locationX>
        <locationY>46</locationY>
        <assignNextValueToReference>V_Bucle_Comercio</assignNextValueToReference>
        <collectionReference>vcr_Comercios</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Crear_comercio_participante</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Elegir_tarjeta</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Bucle_tarjetas</name>
        <label>Bucle tarjetas</label>
        <locationX>1013</locationX>
        <locationY>47</locationY>
        <assignNextValueToReference>v_bucle_tarjeta</assignNextValueToReference>
        <collectionReference>vcr_tarjetas</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>crear_tarjetas_participantes</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Actualizar_la_campa_a</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>Crear_comercio_participante</name>
        <label>Crear comercio participante</label>
        <locationX>620</locationX>
        <locationY>329</locationY>
        <connector>
            <targetReference>Bucle_de_Comercio</targetReference>
        </connector>
        <inputAssignments>
            <field>MX_WF_Campana__c</field>
            <value>
                <elementReference>IdCampania</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>MX_WF_Comercio_participante__c</field>
            <value>
                <elementReference>V_Bucle_Comercio</elementReference>
            </value>
        </inputAssignments>
        <object>MX_WF_Comercios_participantes__c</object>
    </recordCreates>
    <recordCreates>
        <name>crear_tarjetas_participantes</name>
        <label>crear tarjetas participantes</label>
        <locationX>913</locationX>
        <locationY>327</locationY>
        <assignRecordIdToReference>IDTarjetasParticipantes</assignRecordIdToReference>
        <connector>
            <targetReference>Obtener_bines</targetReference>
        </connector>
        <inputAssignments>
            <field>MX_WF_Campa_a__c</field>
            <value>
                <elementReference>IdCampania</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>MX_WF_Tarjeta_participante__c</field>
            <value>
                <elementReference>v_bucle_tarjeta</elementReference>
            </value>
        </inputAssignments>
        <object>MX_WF_Tarjetas_participantes__c</object>
    </recordCreates>
    <recordLookups>
        <name>Obtener_bines</name>
        <label>Obtener bines</label>
        <locationX>814</locationX>
        <locationY>491</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>agregar_coma</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>v_bucle_tarjeta</elementReference>
            </value>
        </filters>
        <object>MX_WF_Catalogo_tarjetas__c</object>
        <outputAssignments>
            <assignToReference>V_Binesdelatarjeta</assignToReference>
            <field>MX_WF_Bines__c</field>
        </outputAssignments>
    </recordLookups>
    <recordUpdates>
        <name>Actualizar_la_campa_a</name>
        <label>Actualizar la campaña</label>
        <locationX>1258</locationX>
        <locationY>53</locationY>
        <connector>
            <targetReference>Abrir_registro</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>IdCampania</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>MX_WF_Bines_que_participan__c</field>
            <value>
                <elementReference>V_agrupadordebines</elementReference>
            </value>
        </inputAssignments>
        <object>Campaign</object>
    </recordUpdates>
    <screens>
        <name>Elegir_tarjeta</name>
        <label>Elegir tarjeta</label>
        <locationX>862</locationX>
        <locationY>64</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Bucle_tarjetas</targetReference>
        </connector>
        <fields>
            <name>Cmp_tarjeta</name>
            <extensionName>c:MX_WF_CmpListaTarjetas</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>Fecha</name>
                <value>
                    <elementReference>F_Fechadeultimamodificacion</elementReference>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>vcr_tarjetas</assignToReference>
                <name>Tarjetas</name>
            </outputParameters>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>GpoComercial</name>
        <label>GpoComercial</label>
        <locationX>170</locationX>
        <locationY>50</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Asignar_grupo_comercial</targetReference>
        </connector>
        <fields>
            <name>Lk_GrupoComercial</name>
            <extensionName>c:MX_WF_LookupComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>fieldName</name>
                <value>
                    <stringValue>GBL_WF_Grupo_Comercial__c</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>objectApiName</name>
                <value>
                    <stringValue>Account</stringValue>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>v_GrupoComercial</assignToReference>
                <name>selectedRecordId</name>
            </outputParameters>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>SeleccionComercios</name>
        <label>Selección Comercios</label>
        <locationX>439</locationX>
        <locationY>51</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Bucle_de_Comercio</targetReference>
        </connector>
        <fields>
            <name>Comercios</name>
            <extensionName>c:MX_WF_CmpListaComercios</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>grupo_comercial</name>
                <value>
                    <elementReference>IdGrupoComercial</elementReference>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>IdGrupoComercial</assignToReference>
                <name>grupo_comercial</name>
            </outputParameters>
            <outputParameters>
                <assignToReference>vcr_Comercios</assignToReference>
                <name>comercio_seleccionado</name>
            </outputParameters>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>GpoComercial</startElementReference>
    <status>Active</status>
    <variables>
        <name>Fechadeultimamodificacion</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>IdCampania</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>IdComercio</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>IdGrupoComercial</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>IDTarjetasParticipantes</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>V_agrupadordebines</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue></stringValue>
        </value>
    </variables>
    <variables>
        <name>V_Binesdelatarjeta</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>V_Bucle_Comercio</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>v_bucle_tarjeta</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>v_GrupoComercial</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vcr_Comercios</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vcr_tarjetas</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
